"""added new fields in marks table - result_status, result_challenge_payment_status, challenged_at

Revision ID: e666ef36f8ec
Revises: 3c190438fe92
Create Date: 2025-12-16 18:09:30.086498

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'e666ef36f8ec'
down_revision: Union[str, Sequence[str], None] = '3c190438fe92'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None

RESULT_STATUS_ENUM = ('published', 'unpublished', 'resolved', 'challenged')
RESULT_STATUS_ENUM_NAME = 'result_status'


def upgrade() -> None:
    result_status_type = postgresql.ENUM(
        *RESULT_STATUS_ENUM, name=RESULT_STATUS_ENUM_NAME)
    result_status_type.create(op.get_bind())
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('marks', sa.Column(
        'result_status',
        result_status_type,
        # sa.Enum('published', 'unpublished', 'resolved', 'challedged', name='result_status'),
        nullable=False,
        server_default='unpublished'
    )
    )
    op.add_column('marks', sa.Column(
        'result_challenge_payment_status', sa.Boolean(), nullable=True))
    op.add_column('marks', sa.Column('challenged_at',
                  sa.DateTime(timezone=True), nullable=True))
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('marks', 'challenged_at')
    op.drop_column('marks', 'result_challenge_payment_status')
    op.drop_column('marks', 'result_status')

    result_status_type = postgresql.ENUM(
        *RESULT_STATUS_ENUM, name=RESULT_STATUS_ENUM_NAME)
    result_status_type.drop(op.get_bind())
    # ### end Alembic commands ###
